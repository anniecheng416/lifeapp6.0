<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2907/2907150.png">
    <title>æˆ‘çš„ç”Ÿæ´»åŠ©æ‰‹ (v5.0 æœ€çµ‚ä¿®å¾©ç‰ˆ)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: { colors: { primary: '#64748b', accent: '#f59e0b', recipe: '#ec4899' } }
            }
        }
    </script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        [v-cloak] { display: none !important; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
        .status-online { background-color: #22c55e; }
        .status-offline { background-color: #ef4444; }
        .status-syncing { background-color: #f59e0b; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        .modal-enter-active, .modal-leave-active { transition: opacity 0.3s ease; }
        .modal-enter-from, .modal-leave-to { opacity: 0; }
        /* IG Embed Ratios */
        .iframe-container { position: relative; width: 100%; height: 100%; overflow: hidden; }
        .iframe-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }
    </style>
</head>
<body class="bg-gray-100 h-screen flex justify-center overflow-hidden">

    <div id="loading-msg" class="absolute inset-0 flex flex-col items-center justify-center bg-white z-50">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
        <p class="text-gray-500 text-sm mt-2">åŠ©æ‰‹å•Ÿå‹•ä¸­...</p>
    </div>

    <div id="app" v-cloak class="w-full max-w-md h-full bg-slate-50 flex flex-col shadow-2xl relative hidden">
        
        <header class="px-5 py-4 bg-white shadow-sm z-10 flex justify-between items-center shrink-0">
            <div>
                <h1 class="text-xl font-bold text-slate-800">{{ currentTabTitle }}</h1>
                <div class="text-xs text-slate-400">{{ todayDate }}</div>
            </div>
            <div class="flex items-center gap-2 bg-slate-50 px-3 py-1.5 rounded-full border border-slate-100">
                <span :class="['status-dot', syncStatusClass]"></span>
                <span class="text-[10px] font-medium text-slate-500">{{ syncStatusText }}</span>
            </div>
        </header>

        <main class="flex-1 overflow-y-auto p-4 no-scrollbar pb-28">
            
            <div v-if="currentTab === 'calendar'" class="space-y-4">
                <div class="bg-white rounded-2xl p-4 shadow-sm">
                    <div class="flex justify-between items-center mb-4">
                        <button @click="changeMonth(-1)" class="p-2 hover:bg-gray-100 rounded-full text-slate-500">&lt;</button>
                        <span class="font-bold text-lg text-slate-800">{{ year }}å¹´ {{ month }}æœˆ</span>
                        <button @click="changeMonth(1)" class="p-2 hover:bg-gray-100 rounded-full text-slate-500">&gt;</button>
                    </div>
                    <div class="grid grid-cols-7 gap-1 text-center text-xs text-slate-400 mb-2 font-medium"><span>æ—¥</span><span>ä¸€</span><span>äºŒ</span><span>ä¸‰</span><span>å››</span><span>äº”</span><span>å…­</span></div>
                    <div class="grid grid-cols-7 gap-1 text-center text-sm">
                        <div v-for="blank in firstDayOfMonth" :key="'blank-'+blank" class="h-10"></div>
                        <div v-for="day in daysInMonth" :key="day" @click="selectDate(day)" :class="['h-14 w-full mx-auto flex flex-col items-center justify-start rounded-lg cursor-pointer transition-all relative border border-transparent', selectedDate === day ? '!border-slate-800 bg-slate-50' : 'hover:bg-slate-50', isToday(day) ? 'text-blue-600 font-bold' : 'text-slate-700', getHoliday(day) ? 'bg-red-50' : '']">
                            <span class="mt-1">{{ day }}</span>
                            <span v-if="getHoliday(day)" class="text-[8px] text-red-500 leading-none px-1 text-center font-bold">{{ getHoliday(day) }}</span>
                            <div v-if="hasTask(day)" class="mt-1 w-1 h-1 rounded-full" :class="selectedDate === day ? 'bg-slate-800' : 'bg-amber-400'"></div>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-2xl p-4 shadow-sm border-t-4 border-slate-200">
                    <h3 class="text-sm font-bold text-slate-500 mb-3 flex items-center gap-2"><span>{{ month }}æœˆ{{ selectedDate }}æ—¥ è¡Œç¨‹</span><span v-if="getHoliday(selectedDate)" class="text-xs bg-red-100 text-red-500 px-2 py-0.5 rounded-full">{{ getHoliday(selectedDate) }}</span></h3>
                    <div class="bg-slate-50 p-3 rounded-xl mb-4 space-y-2 border border-slate-100">
                        <input v-model="calForm.title" type="text" placeholder="äº‹é …" class="w-full bg-white p-2 rounded text-sm outline-none border border-slate-200">
                        <div class="flex gap-2">
                            <input v-model="calForm.who" type="text" placeholder="èª°" class="w-1/3 bg-white p-2 rounded text-sm outline-none border border-slate-200">
                            <div class="flex-1 flex gap-1">
                                <select v-model="calForm.hour" class="flex-1 bg-white p-2 rounded text-sm outline-none border border-slate-200"><option value="" disabled>æ™‚</option><option v-for="h in 24" :value="(h-1).toString().padStart(2,'0')">{{ (h-1).toString().padStart(2,'0') }}</option></select>
                                <select v-model="calForm.minute" class="flex-1 bg-white p-2 rounded text-sm outline-none border border-slate-200"><option value="" disabled>åˆ†</option><option v-for="m in 12" :value="((m-1)*5).toString().padStart(2,'0')">{{ ((m-1)*5).toString().padStart(2,'0') }}</option></select>
                            </div>
                        </div>
                        <button @click="addCalendarEvent" class="w-full bg-slate-800 text-white py-2 rounded-lg text-sm font-medium">æ–°å¢è‡³æ—¥æ›†</button>
                    </div>
                    <div v-for="(task, index) in getSelectedDateTasks" :key="index" class="flex items-start gap-3 p-3 border-b border-slate-50 last:border-0">
                        <div class="text-xs font-bold text-slate-400 pt-1 w-10 text-right">{{ task.time }}</div>
                        <div class="flex-1"><div class="text-slate-800 font-medium text-sm">{{ task.title }}</div><div class="text-xs text-amber-600 bg-amber-50 inline-block px-1.5 py-0.5 rounded mt-1" v-if="task.who">@{{ task.who }}</div></div>
                        <button @click="confirmRemoveCalEvent(task)" class="text-slate-300 hover:text-red-400 px-2 font-bold text-lg">&times;</button>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'tasks'" class="space-y-4">
                <div class="bg-white p-1.5 rounded-xl shadow-sm flex gap-1">
                    <button @click="taskSubTab = 'shopping'" :class="['flex-1 py-2 text-sm font-bold rounded-lg transition', taskSubTab === 'shopping' ? 'bg-orange-500 text-white shadow' : 'text-slate-400']">ğŸ›’ è³¼ç‰©</button>
                    <button @click="taskSubTab = 'todo'" :class="['flex-1 py-2 text-sm font-bold rounded-lg transition', taskSubTab === 'todo' ? 'bg-slate-800 text-white shadow' : 'text-slate-400']">ğŸ“ å¾…è¾¦</button>
                </div>
                <div v-if="taskSubTab === 'shopping'" class="space-y-4">
                    <div class="bg-white p-3 rounded-2xl shadow-sm space-y-2 border-l-4 border-orange-400">
                        <input v-model="shopForm.text" @keyup.enter="addShopItem" type="text" placeholder="è¦è²·ä»€éº¼..." class="w-full bg-transparent p-2 outline-none text-sm border-b border-orange-100">
                        <div class="flex items-center gap-2">
                            <input v-model="shopForm.location" @keyup.enter="addShopItem" type="text" placeholder="é‚£è£¡è²·" class="flex-1 bg-orange-50 p-2 rounded text-xs outline-none">
                            <button @click="addShopItem" class="bg-orange-400 text-white p-2 rounded-lg">+</button>
                        </div>
                    </div>
                    <div v-for="(item, index) in shoppingList" :key="index" class="bg-white p-3 rounded-xl shadow-sm flex items-center justify-between border-l-4 border-orange-300">
                        <div class="flex items-center gap-3">
                            <div @click="toggleShop(index)" :class="['w-5 h-5 rounded-full border cursor-pointer flex items-center justify-center', item.bought ? 'bg-orange-300 border-orange-300' : 'border-slate-300']"><svg v-if="item.bought" class="w-3 h-3 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" /></svg></div>
                            <span :class="['text-sm', item.bought ? 'line-through text-slate-300' : 'text-slate-700 font-medium']">{{ item.text }}</span>
                        </div>
                        <div class="flex items-center"><div v-if="item.location" class="mr-3 text-[10px] text-orange-400">{{ item.location }}</div><button @click="removeShop(index)" class="text-slate-300 hover:text-red-400 px-2">&times;</button></div>
                    </div>
                </div>
                <div v-if="taskSubTab === 'todo'" class="space-y-4">
                    <div class="bg-white p-4 rounded-2xl shadow-sm space-y-3 border-l-4 border-slate-800">
                        <input v-model="todoForm.text" @keyup.enter="addTodo" type="text" placeholder="è¼¸å…¥å¾…è¾¦äº‹é …..." class="w-full bg-slate-50 p-2.5 rounded-lg text-sm outline-none">
                        <div class="flex gap-2">
                            <input v-model="todoForm.who" type="text" placeholder="è² è²¬äºº" class="w-1/3 bg-slate-50 p-2 rounded-lg text-xs outline-none">
                            <input v-model="todoForm.date" type="date" class="flex-1 bg-slate-50 p-2 rounded-lg text-xs outline-none text-slate-500">
                            <button @click="addTodo" class="bg-slate-800 text-white px-4 rounded-lg">+</button>
                        </div>
                    </div>
                    <div v-for="(item, index) in todos" :key="index" class="bg-white p-3 rounded-xl shadow-sm flex flex-col gap-2">
                        <div class="flex items-center gap-3">
                            <div @click="toggleTodo(index)" :class="['w-5 h-5 rounded border cursor-pointer flex items-center justify-center transition', item.done ? 'bg-emerald-500 border-emerald-500' : 'border-slate-300']"><svg v-if="item.done" class="w-3 h-3 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" /></svg></div>
                            <span :class="['flex-1 text-sm text-slate-700', item.done ? 'line-through text-slate-300' : '']">{{ item.text }}</span>
                            <button @click="removeTodo(index)" class="text-slate-300 hover:text-red-400">&times;</button>
                        </div>
                        <div class="flex justify-between items-center ml-8 pt-1 border-t border-slate-50">
                            <div class="flex gap-2 text-[10px]"><span v-if="item.who" class="bg-slate-100 text-slate-500 px-1.5 py-0.5 rounded">{{ item.who }}</span><span v-if="item.date" class="bg-slate-100 text-slate-400 px-1.5 py-0.5 rounded">{{ item.date }}</span></div>
                            <button @click="incrementTodo(item)" class="flex items-center gap-1 bg-amber-50 hover:bg-amber-100 text-amber-600 px-2 py-0.5 rounded-full transition text-[10px] font-medium"><span>æ‰“å¡ {{ item.count }}</span></button>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'recipe'" class="space-y-4">
                <div class="flex gap-2">
                    <div class="bg-white p-1.5 rounded-xl shadow-sm flex gap-1 flex-1">
                        <button @click="recipeFilter = 'main'" :class="['flex-1 py-2 text-sm font-bold rounded-lg transition', recipeFilter === 'main' ? 'bg-recipe text-white shadow' : 'text-slate-400']">ğŸœ ä¸»é£Ÿ</button>
                        <button @click="recipeFilter = 'dessert'" :class="['flex-1 py-2 text-sm font-bold rounded-lg transition', recipeFilter === 'dessert' ? 'bg-recipe text-white shadow' : 'text-slate-400']">ğŸ° ç”œå“</button>
                    </div>
                 </div>
                 
                 <div class="relative">
                     <input v-model="recipeSearch" type="text" placeholder="æœå°‹é£Ÿè­œ..." class="w-full bg-white p-3 rounded-xl shadow-sm outline-none text-sm pl-10 border border-slate-100">
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400 absolute left-3 top-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                 </div>

                <div class="bg-white p-4 rounded-2xl shadow-sm space-y-3 border-l-4 border-pink-400">
                    <input v-model="recipeForm.title" type="text" placeholder="é£Ÿè­œåç¨±..." class="w-full bg-slate-50 p-2.5 rounded-lg outline-none text-slate-700 text-sm">
                    <input v-model="recipeForm.videoUrl" type="text" placeholder="YouTube æˆ– IG é€£çµ (è‡ªå‹•é è¦½)..." class="w-full bg-slate-50 p-2.5 rounded-lg outline-none text-slate-700 text-xs">
                    
                    <div v-if="recipeForm.tempImages.length > 0 || recipeForm.videoPreviewUrl" class="w-full bg-slate-50 rounded-lg overflow-hidden border border-slate-200 mt-2">
                        <div v-if="recipeForm.videoPreviewUrl && recipeForm.videoPreviewUrl.startsWith('IG:')" class="w-full h-64 iframe-container">
                             <iframe :src="`https://www.instagram.com/p/${recipeForm.videoPreviewUrl.split(':')[1]}/embed`" scrolling="no" allowtransparency="true"></iframe>
                        </div>
                        <div v-else-if="recipeForm.videoPreviewUrl" class="w-full aspect-video">
                             <img :src="recipeForm.videoPreviewUrl" class="w-full h-full object-cover">
                        </div>
                        <div v-else class="flex gap-2 overflow-x-auto p-2">
                            <div v-for="(img, idx) in recipeForm.tempImages" :key="idx" class="relative w-16 h-16 rounded overflow-hidden border border-slate-200 shrink-0">
                                <img :src="img" class="object-cover w-full h-full">
                                <button @click="removeTempImage(idx)" class="absolute top-0 right-0 bg-red-500 text-white w-4 h-4 flex items-center justify-center text-[10px]">&times;</button>
                            </div>
                        </div>
                    </div>

                    <textarea v-model="recipeForm.content" placeholder="é£Ÿæèˆ‡åšæ³•..." class="w-full h-20 bg-slate-50 p-2.5 rounded-lg outline-none resize-none text-xs text-slate-600"></textarea>
                    
                    <div class="flex gap-2 text-xs">
                        <label class="flex items-center gap-1 bg-slate-100 px-3 py-2 rounded-lg text-slate-500 cursor-pointer"><input type="radio" v-model="recipeForm.type" value="main"> ä¸»é£Ÿ</label>
                        <label class="flex items-center gap-1 bg-slate-100 px-3 py-2 rounded-lg text-slate-500 cursor-pointer"><input type="radio" v-model="recipeForm.type" value="dessert"> ç”œå“</label>
                        <label class="flex-1 bg-pink-50 text-pink-500 rounded-lg flex items-center justify-center gap-1 py-2 cursor-pointer border border-pink-100">ğŸ“· åŠ ç…§ç‰‡<input type="file" @change="handleRecipeImages" accept="image/*" multiple class="hidden"></label>
                        <button @click="addRecipe" class="bg-recipe text-white px-4 rounded-lg font-bold">æ–°å¢</button>
                    </div>
                </div>

                <div class="grid grid-cols-1 gap-3 pb-20">
                    <div v-for="(item, index) in filteredRecipes" :key="index" @click="openRecipeModal(item)" class="bg-white p-3 rounded-xl shadow-sm flex gap-3 relative cursor-pointer hover:shadow-md transition">
                         <div class="w-24 h-24 bg-slate-100 rounded-lg overflow-hidden flex items-center justify-center shrink-0 border border-slate-100">
                            <img v-if="item.images && item.images.length > 0" :src="item.images[0]" class="w-full h-full object-cover">
                            <div v-else-if="item.videoUrl && item.videoUrl.includes('instagram.com')" class="w-full h-full flex items-center justify-center bg-gradient-to-tr from-yellow-400 via-red-500 to-purple-500 text-white text-3xl">ğŸ“¸</div>
                            <div v-else-if="item.videoUrl && item.videoUrl.includes('youtu')" class="w-full h-full flex items-center justify-center bg-red-600 text-white text-3xl">â–¶</div>
                            <span v-else class="text-2xl">ğŸ²</span>
                        </div>
                        <div class="flex-1 overflow-hidden">
                            <h4 class="font-bold text-slate-800 text-base leading-tight mb-1">{{ item.title }}</h4>
                            <div class="text-[10px] text-pink-500 mb-1" v-if="item.videoUrl">{{ item.videoUrl.includes('instagram.com') ? 'ğŸ“¸ Instagram' : 'â–¶ YouTube' }}</div>
                            <div class="text-[10px] text-slate-500 line-clamp-3 bg-slate-50 p-1.5 rounded">{{ item.content }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'edu'" class="space-y-4">
                <div class="bg-white p-4 rounded-2xl shadow-sm space-y-3">
                    <textarea v-model="eduForm.text" placeholder="è¼¸å…¥æ•™é¤Šç­†è¨˜..." class="w-full h-20 bg-slate-50 p-3 rounded-xl text-sm outline-none resize-none border border-slate-100"></textarea>
                    <div class="flex gap-3">
                        <label class="flex-1 bg-sky-50 text-sky-600 rounded-lg flex items-center justify-center gap-2 py-2 cursor-pointer border border-sky-100">ğŸ“· åŠ åœ–ç‰‡<input type="file" @change="handleEduImage" accept="image/*" class="hidden"></label>
                        <button @click="addEduNote" class="flex-1 bg-slate-800 text-white rounded-lg py-2 text-xs font-bold">æ–°å¢ç­†è¨˜</button>
                    </div>
                </div>
                <div v-for="(item, index) in eduList" :key="index" class="bg-white p-4 rounded-xl shadow-sm flex flex-col gap-3">
                    <div v-if="item.type === 'text'" class="text-slate-700 text-sm whitespace-pre-wrap">{{ item.content }}</div>
                    <img v-else :src="item.content" class="w-full rounded-lg bg-slate-100">
                    <div class="flex justify-between items-center pt-2 border-t border-slate-50">
                        <span class="text-[10px] text-slate-400">{{ item.date }}</span>
                        <div class="flex items-center gap-4">
                            <button @click="incrementShare(item)" class="flex items-center gap-1.5 text-sky-600 bg-sky-50 px-3 py-1 rounded-full"><span class="text-xs font-bold">åˆ†äº« {{ item.shareCount }} æ¬¡</span></button>
                            <button @click="removeEdu(index)" class="text-slate-300 hover:text-red-400">&times;</button>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'book'" class="space-y-4">
                <div class="grid grid-cols-2 gap-3">
                    <div @click="toggleBookFilter('Kobe')" :class="['p-3 rounded-xl text-center shadow-sm border-b-2 cursor-pointer transition', bookFilter === 'Kobe' ? 'bg-indigo-50 border-indigo-500' : 'bg-white border-indigo-400']">
                        <div class="text-xs text-slate-400 font-bold mb-1">Kobe è®€äº†</div>
                        <div class="text-2xl font-bold text-indigo-500">{{ stats.kobe }} <span class="text-xs text-slate-300">æœ¬</span></div>
                    </div>
                    <div @click="toggleBookFilter('Luka')" :class="['p-3 rounded-xl text-center shadow-sm border-b-2 cursor-pointer transition', bookFilter === 'Luka' ? 'bg-teal-50 border-teal-500' : 'bg-white border-teal-400']">
                        <div class="text-xs text-slate-400 font-bold mb-1">Luka è®€äº†</div>
                        <div class="text-2xl font-bold text-teal-500">{{ stats.luka }} <span class="text-xs text-slate-300">æœ¬</span></div>
                    </div>
                </div>
                
                <div class="bg-white p-3 rounded-xl shadow-sm border border-indigo-100 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                    <input v-model="localBookSearch" type="text" placeholder="æœå°‹å·²è¨˜éŒ„çš„æ›¸..." class="flex-1 outline-none text-sm text-slate-700">
                </div>

                <div class="bg-white p-4 rounded-2xl shadow-sm space-y-3 border-l-4 border-indigo-400 relative">
                    <div class="flex gap-2">
                        <input v-model="bookForm.searchText" @keyup.enter="searchBooks" type="text" placeholder="æ–°å¢: ç¶²ä¸Šæœæ›¸å..." class="flex-1 bg-slate-50 p-2 rounded-lg text-sm outline-none">
                        <button @click="searchBooks" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap">
                            <span v-if="isSearching">...</span>
                            <span v-else>ğŸ” æœæ›¸</span>
                        </button>
                    </div>
                    <div v-if="searchResults.length > 0" class="bg-slate-50 rounded-lg p-2 border max-h-60 overflow-y-auto space-y-2">
                        <div v-for="book in searchResults" :key="book.id" @click="selectBook(book)" class="flex gap-3 bg-white p-2 rounded cursor-pointer items-center border border-slate-100 hover:bg-indigo-50">
                            <img :src="book.volumeInfo.imageLinks?.thumbnail || 'https://via.placeholder.com/50'" class="w-10 h-14 object-cover rounded shadow-sm">
                            <div class="flex-1 font-bold text-xs">{{ book.volumeInfo.title }}</div>
                        </div>
                    </div>
                    <div v-if="bookForm.title" class="pt-2 border-t border-slate-100 space-y-3 animate-fade-in">
                        <div class="flex items-center gap-3 bg-indigo-50 p-2 rounded">
                            <img v-if="bookForm.tempCover" :src="bookForm.tempCover" class="w-10 h-14 object-cover rounded">
                            <div class="flex-1 font-bold text-sm text-indigo-900">{{ bookForm.title }}</div>
                            <button @click="clearSelection" class="text-xs text-red-500">é‡é¸</button>
                        </div>
                        <div class="flex gap-2 text-xs">
                            <button @click="toggleReader('Kobe')" :class="['flex-1 py-2 rounded-lg transition font-bold', bookForm.readers.includes('Kobe') ? 'bg-indigo-500 text-white' : 'bg-slate-100']">Kobe</button>
                            <button @click="toggleReader('Luka')" :class="['flex-1 py-2 rounded-lg transition font-bold', bookForm.readers.includes('Luka') ? 'bg-teal-500 text-white' : 'bg-slate-100']">Luka</button>
                        </div>
                        <div class="flex gap-2 items-center">
                            <input v-model="bookForm.date" type="date" class="flex-1 bg-slate-50 p-2 rounded-lg text-xs outline-none">
                            <button @click="addBook" class="bg-indigo-600 text-white px-6 py-2 rounded-lg text-xs font-bold">ç¢ºèªæ–°å¢</button>
                        </div>
                    </div>
                </div>
                <div v-for="(book, index) in filteredBooks" :key="book.id" class="bg-white p-3 rounded-xl shadow-sm flex gap-3 relative">
                    <div class="w-16 h-24 bg-slate-100 rounded-lg overflow-hidden shrink-0 border border-slate-100 shadow-inner">
                        <img v-if="book.cover" :src="book.cover" class="w-full h-full object-cover">
                        <span v-else class="text-2xl flex items-center justify-center h-full">ğŸ“š</span>
                    </div>
                    <div class="flex-1 flex flex-col justify-center">
                        <h4 class="font-bold text-slate-800 text-sm leading-tight">{{ book.title }}</h4>
                        <div class="text-[10px] text-slate-400 mb-2">{{ book.date }}</div>
                        <div class="flex gap-1"><span v-for="reader in book.readers" class="px-2 py-0.5 rounded text-[10px] font-bold text-white bg-indigo-400">{{ reader }}</span></div>
                    </div>
                    <button @click="confirmRemoveBook(book)" class="absolute top-2 right-2 text-slate-300 hover:text-red-400 font-bold p-2">&times;</button>
                </div>
            </div>

        </main>

        <transition name="modal">
            <div v-if="showRecipeModal" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
                <div class="bg-white w-full max-w-md max-h-[85vh] rounded-2xl overflow-hidden flex flex-col shadow-2xl modal-container">
                    
                    <div v-if="!isEditingRecipe" class="flex flex-col h-full overflow-hidden">
                        <div class="w-full bg-black shrink-0 relative aspect-video bg-gray-900">
                            <div v-if="getEmbedUrl(recipeInView.videoUrl)" class="w-full h-full"><iframe :src="getEmbedUrl(recipeInView.videoUrl)" class="w-full h-full" frameborder="0" allowfullscreen></iframe></div>
                            <div v-else-if="recipeInView.videoUrl && recipeInView.videoUrl.includes('instagram.com')" class="w-full h-full iframe-container">
                                <iframe :src="`https://www.instagram.com/p/${recipeInView.videoUrl.match(/(?:p|reel)\/([a-zA-Z0-9_-]+)/)[1]}/embed`" scrolling="no" allowtransparency="true"></iframe>
                            </div>
                            <div v-else class="w-full h-full overflow-x-auto flex snap-x snap-mandatory"><div v-if="recipeInView.images && recipeInView.images.length > 0" v-for="(img, i) in recipeInView.images" :key="i" class="w-full h-full shrink-0 snap-center relative"><img :src="img" class="w-full h-full object-contain"><span v-if="recipeInView.images.length > 1" class="absolute bottom-2 right-2 bg-black/50 text-white text-xs px-2 rounded">{{ i+1 }}/{{ recipeInView.images.length }}</span></div><div v-else class="w-full h-full flex items-center justify-center text-4xl text-white">ğŸ²</div></div>
                            <button @click="showRecipeModal = false" class="absolute top-2 right-2 bg-black/50 text-white rounded-full p-1 z-10">&times;</button>
                        </div>
                        <div class="flex-1 overflow-y-auto p-5 min-h-0 bg-white">
                            <div class="flex justify-between items-start mb-2"><h2 class="text-xl font-bold text-slate-800">{{ recipeInView.title }}</h2><span class="px-2 py-1 rounded text-xs font-bold text-white bg-recipe">{{ recipeInView.type === 'main' ? 'ä¸»é£Ÿ' : 'ç”œå“' }}</span></div>
                            <p class="text-slate-600 text-sm whitespace-pre-wrap leading-relaxed">{{ recipeInView.content }}</p>
                        </div>
                        <div class="p-4 border-t border-slate-100 flex gap-3 shrink-0 bg-white">
                            <button @click="confirmDeleteRecipe(recipeInView)" class="flex-1 py-2 text-red-500 font-bold bg-red-50 rounded-lg">åˆªé™¤</button>
                            <button @click="startEditRecipe" class="flex-1 py-2 text-white font-bold bg-slate-800 rounded-lg">ç·¨è¼¯</button>
                        </div>
                    </div>

                    <div v-else class="flex flex-col h-full overflow-hidden bg-white">
                        <div class="flex-1 overflow-y-auto p-4 gap-3 flex flex-col min-h-0">
                            <h3 class="font-bold text-lg text-slate-800">ç·¨è¼¯é£Ÿè­œ</h3>
                            <input v-model="recipeEditForm.title" class="bg-slate-50 p-3 rounded-lg border border-slate-200" placeholder="é£Ÿè­œåç¨±">
                            <input v-model="recipeEditForm.videoUrl" class="bg-slate-50 p-3 rounded-lg border border-slate-200 text-xs" placeholder="YouTube/IG Link">
                            <textarea v-model="recipeEditForm.content" class="bg-slate-50 p-3 rounded-lg border border-slate-200 h-40 resize-none shrink-0" placeholder="åšæ³•..."></textarea>
                            <div class="flex gap-2"><label class="bg-pink-50 text-pink-500 px-4 py-2 rounded-lg cursor-pointer text-xs flex-1 text-center font-bold">ğŸ“· æ›´æ›/åŠ ç›¸<input type="file" @change="handleEditRecipeImages" accept="image/*" multiple class="hidden"></label></div>
                            <div class="flex gap-2 overflow-x-auto pb-2"><div v-for="(img, idx) in recipeEditForm.tempImages" :key="idx" class="relative w-20 h-20 rounded border shrink-0"><img :src="img" class="object-cover w-full h-full"><button @click="removeEditImage(idx)" class="absolute top-0 right-0 bg-red-500 text-white w-5 h-5 flex items-center justify-center text-xs">&times;</button></div></div>
                        </div>
                        <div class="p-4 border-t border-slate-100 flex gap-3 shrink-0 bg-white">
                            <button @click="isEditingRecipe = false" class="flex-1 py-3 text-slate-500 font-bold bg-slate-100 rounded-lg">å–æ¶ˆ</button>
                            <button @click="saveEditedRecipe" class="flex-1 py-3 text-white font-bold bg-recipe rounded-lg">å„²å­˜</button>
                        </div>
                    </div>
                </div>
            </div>
        </transition>

        <nav class="absolute bottom-0 w-full bg-white border-t border-slate-100 px-2 py-2 flex justify-between items-center z-20 pb-6 shrink-0 text-slate-400">
            <button @click="currentTab = 'calendar'" :class="['flex flex-col items-center gap-1 w-1/5', currentTab === 'calendar' ? 'text-slate-800' : '']"><svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg><span class="text-[10px] font-bold">æ—¥æ›†</span></button>
            <button @click="currentTab = 'tasks'" :class="['flex flex-col items-center gap-1 w-1/5', currentTab === 'tasks' ? 'text-slate-800' : '']"><svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" /></svg><span class="text-[10px] font-bold">ä»»å‹™</span></button>
            <button @click="currentTab = 'recipe'" :class="['flex flex-col items-center gap-1 w-1/5', currentTab === 'recipe' ? 'text-pink-500' : '']"><svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4